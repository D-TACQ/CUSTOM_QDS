


# RW diamond
record(mbbo, "${UUT}:QDS:AVG") {
	field(DTYP, "Soft Channel")
	field(NOBT, "2")
	field(ZRST, "1")
	field(ONST, "2")
	field(TWST, "4")
	field(THST, "8")	
	field(DESC, "Average N values0")
	field(FLNK, "${UUT}:QDS:AVG:w PP")	
}

record(longout, "${UUT}:QDS:AVG:w") {
	field(DTYP, "stream")
	field(OUT,  "@qds.proto set_avg ${SPORT}")
	field(DISV, "1")
	field(SDIS, "${UUT}:QDS:AVG:r.PACT")
	field(OMSL, "closed_loop")
	field(DOL,  "${UUT}:QDS:AVG")
	field(FLNK, "${UUT}:QDS:RESET:t")
}

record(bo, "${UUT}:QDS:RESET:t") {
	field(DTYP, "Soft Channel")
	field (DOL, "1")
	field (OMSL, "closed_loop")
#  field (HIGH, "0.5")
	field (OUT, "${UUT}:QDS:RESET PP")
	
}
record(bo, "${UUT}:QDS:RESET") {
	field(DTYP, "stream")
	field(OUT,  "@qds.proto set_reset ${SPORT}")
	field(HIGH, ".5")
	field(ZNAM, "RUN")
	field(ONAM, "RESET")
	field(DOL,  "1")
	field(PINI, "YES")
}

record(longin, "${UUT}:QDS:AVG:r") {
	field(DTYP, "stream")
	field(INP,  "@qds.proto get_avg ${SPORT}")
	field(SCAN, "1 second")
	field(FLNK, "${UUT}:QDS:AVG")
}

record(longout, "${UUT}:QDS:AVG:s") {
	field(DTYP, "Soft Channel")
	field(OMSL, "closed_loop")
	field(DOL,  "${UUT}:QDS:AVG:r NPP")
	field(OUT,  "${UUT}:QDS:AVG")
}

record(longin, "${UUT}:QDS:EVENTCOUNT") {
	field(DTYP, "stream")
	field(INP,  "@qds.proto get_event_count ${SP2}")
	field(SCAN, "I/O Intr")
	field(FLNK, "${UUT}:QDS:EVENT PP")
}

record(longin, "${UUT}:QDS:BUFFER_COUNT"){
	field(DTYP, "stream")
	field(INP,  "@qds.proto get_bq ${SPQ}")
	field(SCAN, "I/O Intr")
}

record(bi, "${UUT}:QDS:EVENT") {
	field(DTYP, "stream")
	field(INP,  "@qds.proto get_event ${SPORT}")
# 	field(SCAN, "Passive")	
	field(SCAN, ".5 second")
	field(DESC, "indicates threshold crossed")
	
	field(ZNAM, "SAFE")
        field(ONAM, "TRIP")	
}

record(calcout, "${UUT}:QDS:hbcalc") {
	field(SCAN, ".5 second")
	field(INPA, "${UUT}:QDS:BUFFER_COUNT")
	field(INPB, "${UUT}:QDS:hbcalc.LA")
	field(INPC, "${UUT}:QDS:hbcalc")
# toggle if counting	
	field(CALC, "A != B ? !C: 0")
	field(OUT,  "${UUT}:QDS:HEART PP")
}

record(bo, "${UUT}:QDS:HEART") {
	field(DTYP, "stream")
	field(OUT,  "@qds.proto set_heart ${SPORT}")
	field(DESC, "indicates qds capture active")
}

record(bi, "${UUT}:QDS:LATCH") {
	field(DTYP, "stream")
	field(INP,  "@qds.proto get_latch ${SPORT}")
# 	field(SCAN, "Passive")	
	field(SCAN, ".5 second")
	field(DESC, "qds has triggered")
}
record(bo, "${UUT}:QDS:LATCHCLR") {
	field(DTYP, "stream")
	field(OUT,  "@qds.proto set_latch_clr ${SPORT}")
	field(SCAN, "Passive")
	field(HIGH, ".5")
	field(ZNAM, "OFF")
	field(ONAM, "CLR")
	field(DESC, "set 1 to clr latch")
	# WORKTODO  should be a pulse.
}
